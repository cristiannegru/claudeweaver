import{b as o,S as r,o as i}from"../chunks/constants-Bnunqa1d.js";import"../chunks/_commonjsHelpers-CqkleIqs.js";async function s(e){return(await o.storage.local.get(e))[e]??{}}async function l(e){return(await s(r.THREADS))[e]??null}async function d(e){const n=await s(r.SEGMENTS);return Object.values(n).filter(t=>t.thread_id===e).sort((t,a)=>t.sequence-a.sequence)}async function u(){return(await o.storage.local.get(r.ACTIVE_THREAD))[r.ACTIVE_THREAD]??null}console.log("[ClaudeWeaver] Background service worker started");typeof chrome<"u"&&chrome.sidePanel&&chrome.action.onClicked.addListener(e=>{e.id!=null&&chrome.sidePanel.open({tabId:e.id})});i(async(e,n)=>{switch(e.type){case"INTERACTION_DETECTED":console.log(`[ClaudeWeaver] Interaction ${e.count} on segment ${e.segmentId}`);break;case"SPLIT_TRIGGERED":console.log(`[ClaudeWeaver] Split triggered for segment ${e.segmentId}`),await g(e.segmentId);break;case"MANUAL_CHECKPOINT":console.log("[ClaudeWeaver] Manual checkpoint requested");break;case"GET_THREAD_STATE":{const t=await u();if(!t)return{type:"THREAD_STATE",thread:null,segments:[]};const a=await l(t),c=a?await d(t):[];return{type:"THREAD_STATE",thread:a,segments:c}}}});async function g(e){console.log(`[ClaudeWeaver] Checkpoint stub â€” would run ${["extracting","saving_artifacts","generating_brief","uploading_knowledge","building_continuation","opening_segment","renaming"].length} stages for segment ${e}`)}
