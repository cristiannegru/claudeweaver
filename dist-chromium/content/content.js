import{D as g,b,o as m}from"../chunks/constants-Bnunqa1d.js";import"../chunks/_commonjsHelpers-CqkleIqs.js";let r=0;const u=new WeakSet;let s=null,a=null;const l=g.user_message;function f(){const e=document.querySelector(l);if(e){let t=e;for(let n=0;n<10&&t&&(t=t.parentElement,!!t);n++){const o=t.querySelectorAll(l);if(o.length>0&&t.children.length>=o.length&&Array.from(t.children).filter(C=>C.querySelector(l)!==null).length===o.length)return t}}return document.querySelector(g.turn_list_parent)}function E(e){const t=e.querySelectorAll(l);for(const n of t)u.has(n)||(u.add(n),r++,console.log(`[ClaudeWeaver] ðŸ”µ User message detected â€” interaction_count: ${r}`),b.runtime.sendMessage({type:"INTERACTION_DETECTED",count:r,segmentId:""}).catch(o=>{console.warn("[ClaudeWeaver] sendMessage failed:",o.message)}))}function v(e){h(),a=e;const t=e.querySelectorAll(l);for(const n of t)u.add(n);console.log(`[ClaudeWeaver] ðŸ“Ž Conversation observer attached. ${t.length} existing messages baselined.`),s=new MutationObserver(n=>{let o=!1;for(const d of n)if(d.addedNodes.length>0){o=!0;break}o&&E(e)}),s.observe(e,{childList:!0,subtree:!0})}function h(){s&&(s.disconnect(),s=null),a=null}let i=null;const S=300;function M(){i&&clearTimeout(i),i=setTimeout(()=>{const e=f();e&&e!==a?(r=0,console.log("[ClaudeWeaver] ðŸ”„ Navigation detected â€” resetting observer."),v(e)):!e&&a&&(console.log("[ClaudeWeaver] â¸ï¸ Conversation container removed â€” detaching."),h(),r=0)},S)}let c=null;function N(){if(c)return;console.log("[ClaudeWeaver] ðŸš€ Starting root sentinel observer.");const e=f();e&&v(e),c=new MutationObserver(M),c.observe(document.body,{childList:!0,subtree:!0})}N();async function y(){console.log("[ClaudeWeaver] Content script loaded"),m(W)}function W(e){switch(e.type){case"NAVIGATE_SEGMENT":console.log("[ClaudeWeaver] Navigate to segment:",e.segmentId);break}}y().catch(e=>console.error("[ClaudeWeaver] Init failed:",e));
